# ADR-001: 使用PostgreSQL作为主数据库

## 状态
**已接受**

## 背景
LiqPass系统需要存储用户订单、赔付申请、合约事件等结构化数据。我们需要选择一个可靠、可扩展且功能丰富的数据库系统。

## 决策
我们选择PostgreSQL作为主数据库系统。

## 理由

### 优势
1. **ACID兼容**: 完全支持事务，确保数据一致性
2. **丰富的数据类型**: 支持JSONB、数组、范围类型等
3. **强大的查询功能**: 窗口函数、CTE、全文搜索等
4. **可扩展性**: 支持分区、复制、并行查询
5. **成熟稳定**: 经过20+年生产环境验证
6. **活跃的社区**: 持续的功能改进和安全更新

### 与其他选项比较

| 数据库 | 优势 | 劣势 | 适用场景 |
|--------|------|------|----------|
| **PostgreSQL** | 功能丰富、ACID、扩展性强 | 相对复杂、资源消耗较大 | 复杂业务逻辑、事务要求高 |
| MySQL | 简单易用、生态丰富 | 功能相对有限、Oracle控制 | 简单Web应用 |
| MongoDB | 灵活的模式、水平扩展 | 弱事务保证、内存消耗大 | 非结构化数据、快速迭代 |
| SQLite | 轻量级、零配置 | 并发性能差、功能有限 | 移动应用、嵌入式系统 |

## 后果

### 正面影响
- 可以利用PostgreSQL的高级功能简化开发
- 强大的数据完整性和一致性保证
- 丰富的生态系统和工具支持
- 良好的性能和可扩展性

### 负面影响
- 需要更多的运维知识
- 资源消耗相对较高
- 学习曲线相对陡峭

### 中性影响
- 需要专门的DBA技能
- 部署复杂度增加

## 实施指南

### 版本要求
- PostgreSQL 14.0+

### 配置建议
```sql
-- 推荐配置
shared_buffers = 25% of RAM
effective_cache_size = 75% of RAM
work_mem = 50MB
maintenance_work_mem = 512MB
```

### 迁移策略
从开发到生产的平滑迁移：
1. 使用Flyway进行数据库版本管理
2. 建立完整的备份恢复流程
3. 实施监控和告警机制

## 相关决策
- [ADR-002: 数据库分片策略](./002-database-sharding.md)
- [ADR-003: 数据备份和恢复策略](./003-backup-recovery.md)

## 参考资料
1. [PostgreSQL官方文档](https://www.postgresql.org/docs/)
2. [数据库选型指南](https://db-engines.com/en/)
3. [PostgreSQL性能调优](https://wiki.postgresql.org/wiki/Performance_Optimization)