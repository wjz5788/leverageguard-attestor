# 两周修复路线图（P0→P1→P2）

## D1-D3：P0 熔点
- 金库地址保护
  - 环境变量 `PAYMENT_VAULT_ADDRESS` 必填；启动校验非黑洞/零地址
  - 前端在下单前校验目标地址与链 ID
- 订单鉴权与支付回执校验
  - 所有 `/api/v1/orders*` 路由加鉴权（JWT/会话/签名+nonce）
  - 创建订单时根据 `paymentTx` 上链查询，校验 to/token/amount/chainId 与报价一致
- 证据序列化规范
  - 发布 JSON 序列化与哈希测试向量（3 组），加入单元/端到端测试

## D4-D7：P1 强化
- CORS/CSRF/限流
  - 仅允许受信 Origin；敏感路由要求签名；必要处加 CSRF token
  - 路由级滑动窗口限流与错误退避
- 幂等/重放保护
  - 引入 `idempotency-key` 头；创建/赔付路由使用表 `idempotency_keys`
- 日志与脱敏
  - API Key/密钥不落盘；哈希/地址部分显示；统一日志格式
- 赔付/对账
  - 引入 `payout_txs` 与 `audit_events`；透明页读聚合视图

## D8-D14：P2 体验与可观测性
- 触发器与索引
  - 为 orders/claims/payouts/api_accounts 等加 updated_at 触发器
  - user_id/status/created_at 常用查询建索引
- UX/文案与异常引导
  - 敏感用语替换为“保障/赔付”；关键流程异常态给出操作指引
- 运维与可靠性
  - 健康检查/重试/熔断/回退；SLO/错误预算落地；Runbook 完整化

## 交付验收
- 通过《验证闭环自测包》脚本
- 审计问题清单 P0/P1 清零；形成回归用例
- 透明度页接入真实事件数据（替换 Mock）
