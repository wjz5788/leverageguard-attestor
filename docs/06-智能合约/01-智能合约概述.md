这份 `LiqPassPolicySBT` 合约可以在你项目的基础上使用，具体取决于你的需求。合约的功能包括保单购买、结算（赔付）、证据管理等，适用于类似你描述的杠杆交易爆仓保险场景。以下是合约中各个功能的输入与输出：

### 1. **购买保单 (`buyPolicy`)**

#### **输入：**

* **Voucher**: 一个包含购买资格信息的结构体，包含了以下字段：

  * `wallet`: 用户钱包地址。
  * `skuId`: SKU（保单模板）ID。
  * `exchangeId`: 交易所 ID。
  * `accountHash`: 账户信息的哈希值。
  * `deadline`: Voucher 的有效期（时间戳）。
  * `nonce`: 随机数，用于防止重放攻击。
  * `voucherId`: Voucher 唯一标识。

* **Voucher 签名 (`voucherSig`)**: 对 Voucher 的签名，保证其合法性。

* **Quote**: 一个包含报价信息的结构体，包含了以下字段：

  * `wallet`: 用户钱包地址。
  * `inputHash`: 输入信息的哈希。
  * `price`: 保费（以 USDC 为单位，6 位小数）。
  * `maxPayout`: 最大赔付金额（以 USDC 为单位）。
  * `durationHours`: 保单有效期（小时）。
  * `quoteId`: 报价唯一标识。
  * `deadline`: Quote 的有效期（时间戳）。
  * `chainId`: 区块链 ID。
  * `contractAddr`: 合约地址（应该是当前合约地址）。

* **Quote 签名 (`quoteSig`)**: 对 Quote 的签名，保证其合法性。

* **skuId**: 保单的 SKU ID，用于验证该保单模板。

* **notional**: 保单的名义金额。

* **verifyHash**: 用于验证信息的哈希值。

#### **输出：**

* `policyId`: 返回新购买的保单 ID（一个 `uint256` 类型的值）。用户成功购买保单后，会铸造一个新的 ERC-721 Token，即 `Soulbound Token`（SBT），这个 Token 是不可转让的。

#### **过程：**

1. 用户提供有效的 `Voucher` 和 `Quote`。
2. 合约验证签名和有效期。
3. 扣除保费（使用 USDC），并铸造一个不可转让的保单 SBT。
4. 返回购买的 `policyId`，作为用户保单的唯一标识。

---

### 2. **结算赔付 (`settleWithAttestation`)**

#### **输入：**

* **policyId**: 保单 ID，用于指定需要结算的保单。
* **payout**: 赔付金额（以 USDC 为单位）。
* **evidenceHash**: 证据的哈希值，用于验证赔付的合法性。
* **deadline**: 结算的最后有效时间（时间戳），防止超时。
* **sig**: 对结算信息的签名，用于验证结算操作的合法性。

#### **输出：**

* 无输出，赔付成功后会触发 `PolicySettled` 事件，表示保单已经结算并支付赔付金额。

#### **过程：**

1. 用户发起结算请求。
2. 合约验证保单是否有效、是否已过期，是否已结算等。
3. 使用 `Attestor` 的签名验证结算请求。
4. 合约将赔付金额通过 USDC 转账给保单持有者，并更新保单状态为 `Settled`。

---

### 3. **证据附加 (`appendEvidence`)**

#### **输入：**

* **policyId**: 保单 ID，用于附加证据。
* **kind**: 证据类型（`uint8`，例如爆仓、交易失败等类型）。
* **contentHash**: 证据内容的哈希值，用于确保内容未被篡改。
* **uri**: 证据的 URI，可以指向存储证据的外部位置。

#### **输出：**

* 无输出，证据会通过 `EvidenceAppended` 事件触发，记录证据的添加。

#### **过程：**

1. 合约允许具有 `ATTESTOR_ROLE` 权限的用户附加证据。
2. 证据与保单关联，并触发事件记录证据的添加。

---

### 4. **金库管理 (`fundVault`, `withdrawSurplus`)**

#### **`fundVault` 输入：**

* **amount**: 存入金库的金额（以 USDC 为单位）。

#### **`withdrawSurplus` 输入：**

* **amount**: 提取金库的金额（以 USDC 为单位）。
* **to**: 提款目标地址（可以是金库地址或其他地址）。

#### **输出：**

* 无输出，存入和提取金额会触发 `Funded` 和 `Withdrawn` 事件。

#### **过程：**

1. 用户通过 `fundVault` 将资金存入合约金库。
2. 用户通过 `withdrawSurplus` 提取多余的资金。

---

### 5. **禁止转让 (SBT 特性)**

* 保单是不可转让的，合约通过重写 `approve`、`transferFrom` 和 `safeTransferFrom` 方法实现这一点。任何尝试转移保单的操作都会触发 `Soulbound` 错误。

---

### 合约事件：

1. **SkuUpdated**: 当 SKU 配置被更新时触发。
2. **PolicyPurchased**: 当用户购买保单时触发。
3. **PolicySettled**: 当保单被结算（赔付）时触发。
4. **EvidenceAppended**: 当证据被附加到保单时触发。
5. **EpochRootSet**: 可选，设置区块链的 Merkle 根。
6. **Funded**: 当资金存入金库时触发。
7. **Withdrawn**: 当资金从金库提取时触发。

---

### 总结

* **购买保单**：用户需要提供有效的 `Voucher` 和 `Quote` 签名，合约会校验其有效性，并铸造一个不可转让的 ERC-721 保单。
* **赔付结算**：在保险触发时，用户提供结算请求，合约验证合法性后，将赔付金额支付给用户。
* **证据管理**：合约允许指定角色的用户附加证据，确保保单的验证和赔付有充分的链上证据。

这个合约支持与前端的交互，可以通过 Web3 或 Ethers.js 等库与其进行交互。如果你有其他需求或想法，可以根据项目实际情况调整合约。
