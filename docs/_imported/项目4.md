# 项目4

这是项目4的文档内容。

完美，那我们就以 **Ubuntu 22.04 LTS 64 Bit** 作为标准环境，稳定可靠，兼容性最佳。

下面我帮你梳理一下 **完整云服务器配置与环境准备清单（针对 AI 自动化链上测试）**：

------

# **Ubuntu 22.04 云服务器配置清单**

## **1️⃣ 系统基础**

- **操作系统**：Ubuntu 22.04 LTS 64 Bit（完整版，不用最小化 ISO）
- **用户权限**：普通 sudo 用户 + root 可用
- **安全**：SSH key 登录，关闭密码登录

------

## **2️⃣ 系统更新**

```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y build-essential git curl wget unzip
```

------

## **3️⃣ Node.js / npm 环境**

```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs
node -v   # 建议 18.x
npm -v
```

------

## **4️⃣ Python 环境**

```bash
sudo apt install -y python3 python3-pip python3-venv
python3 --version  # 建议 3.10+
pip3 install --upgrade pip
pip3 install web3 python-dotenv
```

------

## **5️⃣ Hardhat / Ethers.js**

```bash
mkdir leverageguard && cd leverageguard
npm init -y
npm install --save-dev hardhat @nomiclabs/hardhat-ethers ethers dotenv
npx hardhat  # 初始化 Hardhat 项目
```

------

## **6️⃣ 项目目录结构**

```
/home/ubuntu/leverageguard/
│
├─ contracts/          # Solidity 合约
│   └─ LeverageGuard.sol
│
├─ scripts/
│   ├─ deploy.js       # 合约部署
│   └─ fund.js         # 资金注入
│
├─ backend/
│   ├─ listener.py     # 事件监听 + 自动 payout
│   └─ LeverageGuard_abi.json
│
├─ frontend/
│   ├─ src/
│   │   └─ App.js     # React 前端
│   └─ build/         # 打包文件
│
├─ .env                # 私钥、RPC
└─ package.json
```

------

## **7️⃣ 环境变量**

```env
PRIVATE_KEY=0x你的部署钱包私钥
OWNER_PRIVATE_KEY=0x你的owner钱包私钥
ARBITRUM_RPC=https://sepolia-rollup.arbitrum.io/rpc
```

- 私钥仅供 AI 或可信程序使用
- 不要上传到 Git

------

## **8️⃣ 后台脚本 & 日志**

```bash
# listener.py 后台运行
nohup python3 backend/listener.py > backend/listener.log 2>&1 &
# 或者 systemd 服务守护
```

- 输出事件、payout tx hash、状态
- 支持 24/7 监听 Gains MarketExecuted

------

## **9️⃣ 备份**

1. **代码备份**

```bash
tar -czvf leverageguard_backup_$(date +%F).tar.gz leverageguard/
```

1. **日志备份**

```bash
cp backend/listener.log /home/ubuntu/backup/listener_$(date +%F).log
```

1. **远程备份**：S3、Google Drive 或私有 Git 仓库

------

✅ **结论**

- Ubuntu 22.04 LTS 完整版 + Node.js 18 + Python3.10 + Hardhat + Web3 = **稳定开发环境**
- 云服务器负责：
  - 合约部署
  - USDC fund
  - 事件监听 + 自动 payout
- 前端 & 用户操作在本地或单独托管即可

------

我可以帮你画一个 **AI + 云服务器 + 链上 + 用户端的完整部署架构图**，让整个流程一目了然，AI 可以直接执行。

你希望我画吗？

明白，我帮你生成一个**AI 可直接执行的顺序命令清单**，每一步都标明：脚本/命令路径、执行动作、RPC 调用示例，让 AI 可以在云服务器上从零跑完整个链上测试。

------

# **LeverageGuard + Perp DEX AI 执行顺序命令清单（云服务器）**

------

## **准备工作**

```bash
# 1️⃣ 安装 Node.js & npm
curl -fsSL https://deb.nodesource.com/setup_18.x | bash
apt install -y nodejs

# 2️⃣ 安装 Hardhat & ethers.js
npm init -y
npm install --save-dev hardhat @nomiclabs/hardhat-ethers ethers dotenv

# 3️⃣ 安装 Python & Web3
apt install -y python3-pip
pip install web3 python-dotenv

# 4️⃣ 配置环境变量
echo "PRIVATE_KEY=0x你的部署钱包私钥" > .env
echo "OWNER_PRIVATE_KEY=0x你的owner钱包私钥" >> .env
echo "ARBITRUM_RPC=https://sepolia-rollup.arbitrum.io/rpc" >> .env
```

> ✅ 云服务器完成 Node.js、Python 环境，AI 可直接执行以下步骤

------

## **步骤 1：部署 LeverageGuard 合约（线上）**

```bash
# 1️⃣ 生成 Solidity 合约 contracts/LeverageGuard.sol
# AI 自动生成模板（buyShield, payout, shield mapping）

# 2️⃣ 生成部署脚本 scripts/deploy.js
# AI 填写 ARBITRUM_RPC & PRIVATE_KEY

# 3️⃣ 部署
npx hardhat run scripts/deploy.js --network arbitrumSepolia

# 输出：
# - 合约地址
# - 保存 ABI 到 backend/LeverageGuard_abi.json
```

------

## **步骤 2：fund LeverageGuard（线上）**

```bash
# 1️⃣ 生成 scripts/fund.js
# 转 1000 USDC 到部署的合约地址

# 2️⃣ AI 构建交易、签名、发送
npx hardhat run scripts/fund.js --network arbitrumSepolia

# 3️⃣ 等待链上确认
# 确认 tx receipt status == 1
```

------

## **步骤 3：启动事件监听（云服务器）**

```bash
# 1️⃣ 后端脚本 backend/listener.py
# 功能：
# - 监听 Gains MarketExecuted 事件
# - 验证 tx receipt status == 1
# - 判定爆仓（pnl <0 且 positionSize==0）
# - 调用 LeverageGuard payout(trader)

# 2️⃣ 启动脚本
export OWNER_PRIVATE_KEY=0x你的owner私钥
python3 backend/listener.py

# 持续监听，AI 可后台守护
```

------

## **步骤 4：前端操作（线下/线上）**

```bash
# 1️⃣ React 前端生成：
# - Buy Insurance（链上 tx）
# - Check Shield（读取合约 mapping）
# - Go to Gains Practice Mode（https://gains.trade/）

# 2️⃣ 用户钱包连接 Arbitrum Sepolia
# 3️⃣ 用户点击 Buy Insurance → tx 上链
# 4️⃣ 用户打开 Gains UI 开仓 → tx 上链
# 5️⃣ 用户爆仓 → MarketExecuted event
```

> AI 可生成前端页面，但用户 MetaMask 仍需手动签名

------

## **步骤 5：自动 payout（云服务器）**

```bash
# 1️⃣ listener.py 捕获 MarketExecuted
# 2️⃣ 验证交易真实性
# 3️⃣ 调用 payout(trader)
# 4️⃣ 等待 tx 上链确认
# 5️⃣ 输出链上 tx、状态到日志
```

------

## **步骤 6：链上验证 & 前端更新**

```bash
# 1️⃣ AI 读取 LeverageGuard.shields(trader)
# 2️⃣ 输出 shield principal / leverage / payout 状态
# 3️⃣ 前端显示更新
# 4️⃣ 所有 tx 可在 https://sepolia.arbiscan.io/ 查询
```

------

## **步骤 7：测试全流程顺序**

| 步骤 | 执行动作                   | AI/用户            |
| ---- | -------------------------- | ------------------ |
| 1    | 部署合约                   | AI                 |
| 2    | fund 1000 USDC             | AI                 |
| 3    | 启动事件监听               | AI（云服务器）     |
| 4    | 前端 Buy Insurance         | 用户（AI生成页面） |
| 5    | Gains 开仓                 | 用户               |
| 6    | 爆仓 → 触发 MarketExecuted | 用户               |
| 7    | 自动 payout                | AI（listener.py）  |
| 8    | 前端显示 shield 更新       | AI + 用户          |

------

✅ **执行说明**

- **AI 可完全自动执行**：部署、fund、监听、自动 payout
- **用户操作仍需手动签名和开仓/爆仓**
- **云服务器**：必需，保证事件监听与 payout 24/7 运行
- **链上查询**：所有 tx 可在 Arbiscan 验证

------

如果你需要，我可以帮你生成一份**最终版 AI 操作手册 PDF**，包含每条命令、脚本路径、RPC 调用示例、顺序图，直接给 AI 运行。

你希望我生成吗？

好，我帮你生成一份**完整 AI 执行任务脚本清单**，适合在云服务器上跑，涵盖 **部署合约 → fund → 事件监听 → 自动 payout → 前端交互提示**，保证 AI 能一步步执行整个链上测试流程。

------

# **LeverageGuard + Perp DEX AI 执行任务清单（云服务器版）**

------

## **1️⃣ 环境准备（云服务器）**

1. **操作系统**：Ubuntu 22.04 或其他 Linux
2. **安装 Node.js & npm**

```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | bash
apt install -y nodejs
```

1. **安装 Hardhat 与 ethers.js**

```bash
npm init -y
npm install --save-dev hardhat @nomiclabs/hardhat-ethers ethers dotenv
```

1. **安装 Python 依赖**

```bash
apt install -y python3-pip
pip install web3 python-dotenv
```

1. **配置环境变量** `.env`

```env
PRIVATE_KEY=0x你的部署钱包私钥
OWNER_PRIVATE_KEY=0x你的owner钱包私钥
ARBITRUM_RPC=https://sepolia-rollup.arbitrum.io/rpc
```

------

## **2️⃣ 部署 LeverageGuard 合约（线上）**

**AI 执行任务**：

1. 生成 `contracts/LeverageGuard.sol`
2. 生成 `scripts/deploy.js`（网络指向 Arbitrum Sepolia）
3. 部署合约：

```bash
npx hardhat run scripts/deploy.js --network arbitrumSepolia
```

1. 输出合约地址 & 保存 ABI 到 `backend/LeverageGuard_abi.json`

------

## **3️⃣ 合约资金准备（线上）**

**AI 执行任务**：

1. 构建 `scripts/fund.js`，转入 1000 USDC
2. 签名 & 发送交易
3. 等待 tx 确认 (`status==1`)
4. 日志输出：资金已入合约，可用于 payout

------

## **4️⃣ 事件监听与自动 payout（云服务器长期运行）**

**Python 脚本 `backend/listener.py`**：

**AI 执行任务**：

1. 连接 Arbitrum Sepolia RPC
2. 监听 Gains `MarketExecuted` 事件
3. 验证交易：
   - tx receipt `status==1`
   - pnl<0 & positionSize==0 → 爆仓
4. 查询 LeverageGuard shield 状态
5. 构建 payout 交易 → 签名 → 发送
6. 输出链上 tx、状态
7. 持续轮询（2秒/轮）

> AI 可保证脚本在云服务器后台运行，实时触发 payout

------

## **5️⃣ 前端交互提示（线下/线上可选）**

**React 前端 `frontend/src/App.js`**：

**AI 执行任务**：

1. 生成 Buy Insurance 按钮 → 链上交易
2. 生成 Check Shield 按钮 → 显示 principal/杠杆
3. 生成跳转 Gains Practice Mode 按钮
4. 输出链上 tx 链接到 Arbiscan

> 用户手动 MetaMask 签名交易 & 在 Gains UI 开仓/爆仓

------

## **6️⃣ 用户操作（本地）**

1. 钱包切换到 Arbitrum Sepolia
2. 获取测试 ETH / USDC
3. Buy Insurance → 链上生成 tx
4. 前往 Gains Practice Mode → 开仓 → 爆仓

------

## **7️⃣ 链上事件与自动赔付示例流程**

| 步骤 | 链上 tx / 事件          | AI 执行                   |
| ---- | ----------------------- | ------------------------- |
| 1    | 部署 LeverageGuard      | deploy.js                 |
| 2    | fund USDC               | fund.js                   |
| 3    | 用户 Buy Insurance      | 前端 tx                   |
| 4    | 用户开仓                | Gains tx                  |
| 5    | 爆仓触发 MarketExecuted | listener.py 捕获          |
| 6    | 自动 payout             | listener.py 构建并发送 tx |
| 7    | 前端显示 shield 更新    | React UI                  |

------

## **8️⃣ AI 执行规范**

- `.env` 管理私钥
- 所有链上操作可在 Arbiscan 查询
- 事件监听独立进程，不阻塞
- 前端仅显示状态，不存储私钥
- AI 可模拟 MarketExecuted 测试 payout 逻辑

------

✅ **总结**

- AI 可直接执行整个链上测试流程
- 云服务器用于 **事件监听 + 自动 payout**
- 前端 & 用户操作仍需手动签名和开仓
- 使用 Gains Practice Mode + Arbitrum Sepolia，无需自己搭建 Perp DEX

------

我可以帮你进一步生成一份 **AI 执行顺序命令列表**，每一步对应具体命令、脚本路径、RPC 调用示例，让 AI 可以直接在云服务器上顺序执行整个链上测试。

你希望我生成吗？

完全可以，现在 AI **理论上可以按照我整理的步骤执行整个流程**，尤其是你有一台云服务器的话，会让流程更顺畅。下面我给你分析一下：

------

## **1️⃣ AI 能做的部分**

| 模块             | AI 可执行任务                                                |
| ---------------- | ------------------------------------------------------------ |
| **合约部署**     | 自动生成 LeverageGuard.sol、Hardhat 部署脚本、deploy 到 Arbitrum Sepolia |
| **合约资金准备** | fund USDC 到合约、构建并发送交易                             |
| **事件监听**     | Python 脚本持续监听 Gains MarketExecuted 事件、验证交易真实性、调用 payout |
| **前端生成**     | React 页面生成 Buy Insurance、Check Shield、跳转 Gains UI 按钮 |
| **链上验证**     | AI 可以调用 RPC 检查 tx receipt、查询 shield 状态            |

------

## **2️⃣ AI 无法做的部分**

| 模块                         | 说明                                                       |
| ---------------------------- | ---------------------------------------------------------- |
| **用户钱包操作**             | AI 无法控制用户 MetaMask 签名或获取测试网 ETH/USDC         |
| **Gains Practice Mode 交易** | AI 无法直接操作 Web UI 开仓/爆仓（除非做自动化浏览器操作） |

------

## **3️⃣ 云服务器的作用**

- **后端事件监听**：必须长期运行，AI 可在云服务器上部署 Python listener.py
- **链上自动 payout**：通过云服务器构建/签名交易，保证实时响应爆仓事件
- **可选**：也可以在云服务器部署前端（Vercel/Netlify 也可），方便用户访问

> **结论**：云服务器**必需**如果你希望 AI 完全自动监听事件并发起链上 payout，否则只能本地运行。

------

## **4️⃣ AI 操作建议**

1. **在云服务器部署**：
   - Python 监听脚本 `listener.py`
   - 配置 `.env` 私钥
   - 保证服务器网络稳定、RPC 可访问
2. **在 AI 里执行**：
   - 合约部署 + fund
   - 事件监听逻辑自动化
   - 构建 payout 交易
3. **前端**：
   - 用户本地访问 React UI
   - 手动钱包签名买保险
4. **链上真实交易**：
   - 用户在 Gains Practice Mode 开仓、爆仓
   - AI 自动捕获 MarketExecuted → payout

------

✅ **总结**

- **AI 可以执行绝大部分流程**，尤其是部署、监听、自动 payout
- **云服务器是必须的**，保证事件监听和链上操作连续执行
- 用户必须手动完成 MetaMask 签名和在 Gains UI 开仓/爆仓

------

如果你希望，我可以帮你写一份 **完整 AI 执行的任务脚本清单**，从部署合约、fund、事件监听到 payout，确保 AI 能直接跑在你的云服务器上操作。

你希望我直接生成吗？