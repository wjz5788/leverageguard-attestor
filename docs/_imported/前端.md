### LeverageGuard é¡¹ç›®å‰ç«¯å®ç°æŒ‡å—

åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°å‰ç«¯éƒ¨åˆ†ï¼åŸºäºé¡¹ç›®ç»“æ„ï¼ˆ`/root/leverageguard/frontend/`ï¼‰ï¼Œå‰ç«¯æ˜¯ä¸€ä¸ªç®€å•çš„é™æ€ Web ç•Œé¢ï¼ˆHTML/JS/CSSï¼‰ï¼Œç”¨äºæ˜¾ç¤ºç³»ç»ŸçŠ¶æ€ï¼ˆå¦‚åˆçº¦åœ°å€ã€å®æ—¶åŒºå—ã€äº‹ä»¶æ—¥å¿—ã€èµ”ä»˜å†å²ï¼‰ã€‚å®ƒä¸éœ€å¤æ‚æ¡†æ¶ï¼ˆå¦‚ Reactï¼‰ï¼Œç”¨ vanilla JS + Web3.js è¿æ¥ Arbitrum Sepolia RPCï¼Œè½®è¯¢åç«¯æ—¥å¿—æˆ–åˆçº¦æ•°æ®ã€‚å¯åŠ¨ç”¨ `live-server`ï¼ˆNode.js å·¥å…·ï¼‰ï¼Œæµè§ˆå™¨è®¿é—® `http://localhost:8080`ã€‚

æ€»æ—¶é•¿ <15 åˆ†é’Ÿã€‚å‡è®¾æ‚¨åœ¨ `/root/leverageguard` ç›®å½•ï¼ŒNode.js å·²å®‰è£…ï¼ˆä» `install_and_compile.sh`ï¼‰ã€‚å¦‚æœæ— ï¼Œè¿è¡Œ `sudo apt update && sudo apt install nodejs npm`ã€‚

#### æ­¥éª¤ 1: å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆ2 åˆ†é’Ÿï¼‰
1. è¿›å…¥å‰ç«¯ç›®å½•ï¼š
   ```
   cd /root/leverageguard/frontend
   ```
2. åˆå§‹åŒ– npmï¼ˆå¦‚æœæ—  package.jsonï¼‰ï¼š
   ```
   npm init -y
   ```
3. å®‰è£…æ ¸å¿ƒä¾èµ–ï¼š
   ```
   npm install web3 live-server --save-dev
   ```
   - `web3`: JS åº“è¿æ¥ RPC/åˆçº¦ã€‚
   - `live-server`: çƒ­é‡è½½æœåŠ¡å™¨ã€‚

**éªŒè¯**ï¼š`ls node_modules/` æ˜¾ç¤º web3/live-server æ–‡ä»¶å¤¹ã€‚

#### æ­¥éª¤ 2: æ›´æ–°å‰ç«¯ä»£ç ï¼ˆ5 åˆ†é’Ÿï¼‰
é¡¹ç›® `src/index.html` æ˜¯å…¥å£ï¼ˆå¦‚æœæ— ï¼Œåˆ›å»ºï¼‰ã€‚ç”¨ä»¥ä¸‹æ¨¡æ¿æ›¿æ¢/åˆ›å»ºæ–‡ä»¶ï¼Œç¡®ä¿æ˜¾ç¤ºåˆçº¦çŠ¶æ€ã€å®æ—¶åŒºå—ã€æ—¥å¿—ã€‚

- **src/index.html**ï¼ˆå®Œæ•´ä»£ç ï¼Œå¤åˆ¶ç²˜è´´ï¼‰ï¼š
  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>LeverageGuard Dashboard</title>
      <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
      <style>
          body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
          .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
          .status { background: #e7f3ff; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
          #logs { height: 300px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; background: #f9f9f9; }
          button { background: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }
          button:hover { background: #0056b3; }
      </style>
  </head>
  <body>
      <div class="container">
          <h1>LeverageGuard Dashboard</h1>
          <div class="status" id="status">è¿æ¥ä¸­...</div>
          <p><strong>åˆçº¦åœ°å€:</strong> <span id="contractAddr">åŠ è½½ä¸­...</span></p>
          <p><strong>å½“å‰åŒºå—:</strong> <span id="currentBlock">åŠ è½½ä¸­...</span></p>
          <p><strong>åˆçº¦ä½™é¢:</strong> <span id="contractBalance">åŠ è½½ä¸­...</span></p>
          <button onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
          <button onclick="fetchLogs()">åˆ·æ–°æ—¥å¿—</button>
          <h3>äº‹ä»¶æ—¥å¿—:</h3>
          <div id="logs"></div>
      </div>
  
      <script>
          const CONTRACT_ADDRESS = '0x2af5cE1fD7Bc381d993055897B96EdBccE49EBf4';  // ä» .env
          const RPC_URL = 'https://sepolia-rollup.arbitrum.io/rpc';  // æˆ–æ‚¨çš„ ALCHEMY_RPC_URL
          const ABI = [ /* å¤åˆ¶æ‚¨çš„ CONTRACT_ABIï¼Œä» backend/event_listener.py */ 
              {"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"executePayout","outputs":[],"stateMutability":"nonpayable","type":"function"},
              {"inputs":[],"name":"contractBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
          ];  // ç®€ç‰ˆ ABIï¼Œä»…éœ€ view å‡½æ•°
  
          let web3 = new Web3(RPC_URL);
          let contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
          let account = null;
  
          async function connectWallet() {
              if (window.ethereum) {
                  try {
                      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                      account = accounts[0];
                      document.getElementById('status').innerHTML = `å·²è¿æ¥: ${account}`;
                      updateData();
                  } catch (error) {
                      document.getElementById('status').innerHTML = `è¿æ¥å¤±è´¥: ${error.message}`;
                  }
              } else {
                  alert('è¯·å®‰è£… MetaMaskï¼');
              }
          }
  
          async function updateData() {
              try {
                  const block = await web3.eth.getBlockNumber();
                  document.getElementById('currentBlock').innerText = block;
  
                  const balance = await contract.methods.contractBalance().call();
                  document.getElementById('contractBalance').innerText = web3.utils.fromWei(balance, 'ether') + ' ETH';
  
                  document.getElementById('contractAddr').innerText = CONTRACT_ADDRESS;
                  document.getElementById('status').innerHTML = 'åœ¨çº¿ | æœ€åæ›´æ–°: ' + new Date().toLocaleTimeString();
              } catch (error) {
                  document.getElementById('status').innerHTML = `æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`;
              }
          }
  
          async function fetchLogs() {
              // æ¨¡æ‹Ÿä»åç«¯æ—¥å¿—æ‹‰å–ï¼ˆå®é™…ç”¨ API æˆ– WebSocketï¼›è¿™é‡Œè½®è¯¢æœ¬åœ°æ—¥å¿—æ–‡ä»¶ via fetchï¼Œå¦‚æœåç«¯æš´éœ²ï¼‰
              try {
                  const response = await fetch('/logs/event_listener.log');  // å‡è®¾åç«¯æœ‰ API ç«¯ç‚¹ï¼›å¦åˆ™ç”¨ console.log æ¨¡æ‹Ÿ
                  const logs = await response.text();
                  document.getElementById('logs').innerHTML = logs.split('\n').slice(-10).join('<br>');  // æœ€å 10 è¡Œ
              } catch (error) {
                  document.getElementById('logs').innerHTML = 'æ—¥å¿—åŠ è½½å¤±è´¥: ' + error.message + '<br>ç¤ºä¾‹: 2025-10-09 INFO - å½“å‰åŒºå—: 202769527';
                  // å®é™…é›†æˆ: æ·»åŠ åç«¯ Flask API è¿”å›æ—¥å¿—
              }
          }
  
          // è‡ªåŠ¨æ›´æ–°æ¯ 10s
          setInterval(updateData, 10000);
          updateData();  // åˆå§‹åŠ è½½
          fetchLogs();   // åˆå§‹æ—¥å¿—
      </script>
  </body>
  </html>
  ```

- **å…³é”®è¯´æ˜**ï¼š
  - **ABI**ï¼šä»åç«¯å¤åˆ¶ï¼ˆä»… view å‡½æ•°ï¼Œå‡å°‘å¤§å°ï¼‰ã€‚
  - **æ—¥å¿—æ‹‰å–**ï¼šå½“å‰æ¨¡æ‹Ÿï¼›ç”Ÿäº§åŠ åç«¯ API (e.g., Flask `/api/logs` è¿”å› tail -n 20)ã€‚
  - **é’±åŒ…é›†æˆ**ï¼šMetaMask è¿æ¥ï¼Œæ˜¾ç¤ºè´¦æˆ·ã€‚
  - ä¿å­˜åï¼Œçƒ­é‡è½½è‡ªåŠ¨ç”Ÿæ•ˆã€‚

#### æ­¥éª¤ 3: å¯åŠ¨å‰ç«¯æœåŠ¡å™¨ï¼ˆ2 åˆ†é’Ÿï¼‰
1. åœ¨ `/root/leverageguard/frontend`ï¼š
   ```
   npx live-server src --port=8080 --host=0.0.0.0  # å…è®¸å¤–éƒ¨è®¿é—®
   ```
   - `--host=0.0.0.0`: æœåŠ¡å™¨ IP ç»‘å®šï¼Œä¾¿äºè¿œç¨‹æµ‹è¯•ã€‚

2. **éªŒè¯**ï¼š
   - æµè§ˆå™¨æ‰“å¼€ `http://localhost:8080/index.html`ï¼ˆæˆ–æ‚¨çš„æœåŠ¡å™¨ IP:8080ï¼‰ã€‚
   - é¢„æœŸï¼šé¡µé¢åŠ è½½ "åœ¨çº¿" çŠ¶æ€ã€åˆçº¦åœ°å€ã€åŒºå—å·ã€ä½™é¢ï¼›ç‚¹å‡» "è¿æ¥é’±åŒ…" å¼¹å‡º MetaMaskï¼›"åˆ·æ–°æ—¥å¿—" æ˜¾ç¤ºç¤ºä¾‹æ—¥å¿—ã€‚
   - æ§åˆ¶å°æ—  JS é”™è¯¯ï¼ˆF12 æ£€æŸ¥ï¼‰ã€‚

#### æ­¥éª¤ 4: é›†æˆä¸æµ‹è¯•ï¼ˆ5 åˆ†é’Ÿï¼‰
1. **å®æ—¶æ•°æ®**ï¼šé¡µé¢æ¯ 10s åˆ·æ–°åŒºå—/ä½™é¢ï¼ˆè¿æ¥ Arbitrum Sepoliaï¼‰ã€‚
2. **äº‹ä»¶æµ‹è¯•**ï¼šè¿è¡Œåç«¯æµ‹è¯•ï¼ˆemit PositionLiquidatedï¼‰ï¼Œé¡µé¢ "åˆ·æ–°æ—¥å¿—" åº”æ˜¾ç¤ºæ–°äº‹ä»¶ï¼ˆéœ€åç«¯ API æ‰©å±•ï¼‰ã€‚
3. **æ‰©å±•**ï¼ˆå¯é€‰ï¼‰ï¼š
   - åŠ  WebSocketï¼šåç«¯ç”¨ `flask-socketio` æ¨é€æ—¥å¿—ï¼Œå‰ç«¯ `socket.io-client` è®¢é˜…ã€‚
   - éƒ¨ç½²ï¼šç”¨ Vercel/Netlifyï¼ˆ`npm run build` + git pushï¼‰ï¼Œæˆ– Nginx åä»£æœ¬åœ°ã€‚

**å¸¸è§é—®é¢˜**ï¼š
| é—®é¢˜          | è§£å†³æ–¹æ¡ˆ                                                     |
| ------------- | ------------------------------------------------------------ |
| **ç«¯å£å ç”¨**  | `npx live-server src --port=3000` æ”¹ç«¯å£ã€‚                   |
| **Web3 é”™è¯¯** | ç¡®è®¤ RPC_URL æœ‰æ•ˆï¼›MetaMask åˆ‡æ¢åˆ° Arbitrum Sepoliaã€‚        |
| **æ—¥å¿—ç©ºç™½**  | å®ç°åç«¯ `/api/logs`ï¼šåœ¨ event_listener.py åŠ  Flask è·¯ç”±ï¼Œè¿”å› `subprocess.check_output('tail -n 20 logs/event_listener.log')`ã€‚ |
| **CORS**      | live-server é»˜è®¤å…è®¸ï¼›ç”Ÿäº§ç”¨ proxyã€‚                         |

å‰ç«¯æå®šåï¼Œç³»ç»Ÿå…¨æ ˆå°±ç»ªï¼è¿è¡Œå¯åŠ¨å‘½ä»¤ï¼Œåˆ†äº«é¡µé¢æˆªå›¾/é”™è¯¯ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œæˆ‘å¸®è°ƒã€‚æ¥ä¸‹æ¥æµ‹è¯•äº‹ä»¶ï¼ŸğŸš€