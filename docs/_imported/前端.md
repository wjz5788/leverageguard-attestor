### LeverageGuard 项目前端实现指南

别担心，我们切换到前端部分！基于项目结构（`/root/leverageguard/frontend/`），前端是一个简单的静态 Web 界面（HTML/JS/CSS），用于显示系统状态（如合约地址、实时区块、事件日志、赔付历史）。它不需复杂框架（如 React），用 vanilla JS + Web3.js 连接 Arbitrum Sepolia RPC，轮询后端日志或合约数据。启动用 `live-server`（Node.js 工具），浏览器访问 `http://localhost:8080`。

总时长 <15 分钟。假设您在 `/root/leverageguard` 目录，Node.js 已安装（从 `install_and_compile.sh`）。如果无，运行 `sudo apt update && sudo apt install nodejs npm`。

#### 步骤 1: 安装前端依赖（2 分钟）
1. 进入前端目录：
   ```
   cd /root/leverageguard/frontend
   ```
2. 初始化 npm（如果无 package.json）：
   ```
   npm init -y
   ```
3. 安装核心依赖：
   ```
   npm install web3 live-server --save-dev
   ```
   - `web3`: JS 库连接 RPC/合约。
   - `live-server`: 热重载服务器。

**验证**：`ls node_modules/` 显示 web3/live-server 文件夹。

#### 步骤 2: 更新前端代码（5 分钟）
项目 `src/index.html` 是入口（如果无，创建）。用以下模板替换/创建文件，确保显示合约状态、实时区块、日志。

- **src/index.html**（完整代码，复制粘贴）：
  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>LeverageGuard Dashboard</title>
      <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
      <style>
          body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
          .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
          .status { background: #e7f3ff; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
          #logs { height: 300px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; background: #f9f9f9; }
          button { background: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }
          button:hover { background: #0056b3; }
      </style>
  </head>
  <body>
      <div class="container">
          <h1>LeverageGuard Dashboard</h1>
          <div class="status" id="status">连接中...</div>
          <p><strong>合约地址:</strong> <span id="contractAddr">加载中...</span></p>
          <p><strong>当前区块:</strong> <span id="currentBlock">加载中...</span></p>
          <p><strong>合约余额:</strong> <span id="contractBalance">加载中...</span></p>
          <button onclick="connectWallet()">连接钱包</button>
          <button onclick="fetchLogs()">刷新日志</button>
          <h3>事件日志:</h3>
          <div id="logs"></div>
      </div>
  
      <script>
          const CONTRACT_ADDRESS = '0x2af5cE1fD7Bc381d993055897B96EdBccE49EBf4';  // 从 .env
          const RPC_URL = 'https://sepolia-rollup.arbitrum.io/rpc';  // 或您的 ALCHEMY_RPC_URL
          const ABI = [ /* 复制您的 CONTRACT_ABI，从 backend/event_listener.py */ 
              {"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"executePayout","outputs":[],"stateMutability":"nonpayable","type":"function"},
              {"inputs":[],"name":"contractBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
          ];  // 简版 ABI，仅需 view 函数
  
          let web3 = new Web3(RPC_URL);
          let contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
          let account = null;
  
          async function connectWallet() {
              if (window.ethereum) {
                  try {
                      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                      account = accounts[0];
                      document.getElementById('status').innerHTML = `已连接: ${account}`;
                      updateData();
                  } catch (error) {
                      document.getElementById('status').innerHTML = `连接失败: ${error.message}`;
                  }
              } else {
                  alert('请安装 MetaMask！');
              }
          }
  
          async function updateData() {
              try {
                  const block = await web3.eth.getBlockNumber();
                  document.getElementById('currentBlock').innerText = block;
  
                  const balance = await contract.methods.contractBalance().call();
                  document.getElementById('contractBalance').innerText = web3.utils.fromWei(balance, 'ether') + ' ETH';
  
                  document.getElementById('contractAddr').innerText = CONTRACT_ADDRESS;
                  document.getElementById('status').innerHTML = '在线 | 最后更新: ' + new Date().toLocaleTimeString();
              } catch (error) {
                  document.getElementById('status').innerHTML = `数据加载失败: ${error.message}`;
              }
          }
  
          async function fetchLogs() {
              // 模拟从后端日志拉取（实际用 API 或 WebSocket；这里轮询本地日志文件 via fetch，如果后端暴露）
              try {
                  const response = await fetch('/logs/event_listener.log');  // 假设后端有 API 端点；否则用 console.log 模拟
                  const logs = await response.text();
                  document.getElementById('logs').innerHTML = logs.split('\n').slice(-10).join('<br>');  // 最后 10 行
              } catch (error) {
                  document.getElementById('logs').innerHTML = '日志加载失败: ' + error.message + '<br>示例: 2025-10-09 INFO - 当前区块: 202769527';
                  // 实际集成: 添加后端 Flask API 返回日志
              }
          }
  
          // 自动更新每 10s
          setInterval(updateData, 10000);
          updateData();  // 初始加载
          fetchLogs();   // 初始日志
      </script>
  </body>
  </html>
  ```

- **关键说明**：
  - **ABI**：从后端复制（仅 view 函数，减少大小）。
  - **日志拉取**：当前模拟；生产加后端 API (e.g., Flask `/api/logs` 返回 tail -n 20)。
  - **钱包集成**：MetaMask 连接，显示账户。
  - 保存后，热重载自动生效。

#### 步骤 3: 启动前端服务器（2 分钟）
1. 在 `/root/leverageguard/frontend`：
   ```
   npx live-server src --port=8080 --host=0.0.0.0  # 允许外部访问
   ```
   - `--host=0.0.0.0`: 服务器 IP 绑定，便于远程测试。

2. **验证**：
   - 浏览器打开 `http://localhost:8080/index.html`（或您的服务器 IP:8080）。
   - 预期：页面加载 "在线" 状态、合约地址、区块号、余额；点击 "连接钱包" 弹出 MetaMask；"刷新日志" 显示示例日志。
   - 控制台无 JS 错误（F12 检查）。

#### 步骤 4: 集成与测试（5 分钟）
1. **实时数据**：页面每 10s 刷新区块/余额（连接 Arbitrum Sepolia）。
2. **事件测试**：运行后端测试（emit PositionLiquidated），页面 "刷新日志" 应显示新事件（需后端 API 扩展）。
3. **扩展**（可选）：
   - 加 WebSocket：后端用 `flask-socketio` 推送日志，前端 `socket.io-client` 订阅。
   - 部署：用 Vercel/Netlify（`npm run build` + git push），或 Nginx 反代本地。

**常见问题**：
| 问题          | 解决方案                                                     |
| ------------- | ------------------------------------------------------------ |
| **端口占用**  | `npx live-server src --port=3000` 改端口。                   |
| **Web3 错误** | 确认 RPC_URL 有效；MetaMask 切换到 Arbitrum Sepolia。        |
| **日志空白**  | 实现后端 `/api/logs`：在 event_listener.py 加 Flask 路由，返回 `subprocess.check_output('tail -n 20 logs/event_listener.log')`。 |
| **CORS**      | live-server 默认允许；生产用 proxy。                         |

前端搞定后，系统全栈就绪！运行启动命令，分享页面截图/错误（如果有），我帮调。接下来测试事件？🚀