### 这个月（2025年10月）CRV/USDC合约交易详情查询程序

是的，我已更新程序，调整时间范围为**2025年10月1日 00:00:00 到当前**（基于当前日期2025-10-10）。程序会查询您的币安USDC-M期货交易历史（/fapi/v1/userTrades端点），打印所有交易详情，包括时间、数量、价格、价值、实现盈亏、手续费等。还会汇总累计盈亏和潜在爆仓记录（负P&L + >=100 USDC仓位）。

**关键更新**：
- 时间范围：固定为本月（START_TIME=1759276800000 ms）。
- 输出：详细表格格式（用Pandas打印，便于阅读），加上JSON导出（可选保存为文件）。
- 依赖：加`pandas`（云服务器pip install pandas）。

在云服务器上：
1. `pip install pandas requests`。
2. 替换`API_SECRET`为真实值。
3. 运行`python3 verify_monthly_trades.py`。
4. 输出会打印交易列表；如果有交易，会显示汇总。

#### 完整代码（保存为verify_monthly_trades.py）
```python
import hmac
import hashlib
import time
import requests
import json
import pandas as pd  # 用于表格打印
from urllib.parse import urlencode
from datetime import datetime

# Binance USDC-M Futures API 配置（CRV/USDC 合约）
BASE_URL = 'https://fapi.binance.com'
API_KEY = 'N17sFeRoRSQNi39IZSYUftWmBz6xW68yB2ytCV5iQL5W5bUFYA28yY'  # 您的API Key
API_SECRET = 'YOUR_SECRET_HERE'  # **替换**：完整Secret（32位）
SYMBOL = 'CRVUSDC'
MIN_VALUE_USD = 100  # 爆仓阈值（可选）

# 本月时间范围（2025-10-01 00:00:00 ~ 当前）
START_TIME = 1759276800000  # 2025-10-01 ms
END_TIME = int(time.time() * 1000)  # 当前 ms

def get_current_ip():
    try:
        resp = requests.get('https://httpbin.org/ip', timeout=5)
        return resp.json()['origin']
    except:
        return 'IP查询失败'

def create_signature(query_string):
    return hmac.new(API_SECRET.encode('utf-8'), query_string.encode('utf-8'), hashlib.sha256).hexdigest()

def fetch_monthly_trades():
    current_ip = get_current_ip()
    print(f"云服务器IP: {current_ip}（白名单确认）")
    
    endpoint = '/fapi/v1/userTrades'
    params = {
        'symbol': SYMBOL,
        'startTime': START_TIME,
        'endTime': END_TIME,
        'limit': 1000  # 最多1000条；如果超，需分页
    }
    query_string = urlencode(params)
    params['signature'] = create_signature(query_string)
    headers = {'X-MBX-APIKEY': API_KEY}
    
    url = f"{BASE_URL}{endpoint}?{urlencode(params)}"
    try:
        print(f"查询本月交易: {url[:100]}...")
        response = requests.get(url, headers=headers, timeout=10)
        
        if response.status_code == 200:
            trades = response.json()
            print(f"成功查询到 {len(trades)} 条 CRV/USDC 交易记录（2025-10-01 ~ {datetime.fromtimestamp(END_TIME/1000).strftime('%Y-%m-%d %H:%M:%S')}）。")
            
            if not trades:
                print("本月无交易记录。")
                return [], 0.0, []
            
            # 转换为DataFrame打印详情
            trade_data = []
            total_pnl = 0.0
            liquidations = []
            for trade in trades:
                pnl = float(trade.get('realizedPnl', 0))
                total_pnl += pnl
                qty = float(trade['qty'])
                price = float(trade['price'])
                value = qty * price
                is_buyer = '买入' if trade['isBuyer'] else '卖出'
                side = '平空仓' if is_buyer else '平多仓'  # 简化方向
                
                trade_row = {
                    '交易ID': trade['id'],
                    '时间': datetime.fromtimestamp(trade['time'] / 1000).strftime('%Y-%m-%d %H:%M:%S'),
                    '方向': is_buyer,
                    '数量 (CRV)': qty,
                    '价格 (USDC)': price,
                    '价值 (USDC)': round(value, 2),
                    '实现盈亏 (USDC)': round(pnl, 4),
                    '手续费 (USDC)': float(trade.get('commission', 0)),
                    '平仓类型': side
                }
                trade_data.append(trade_row)
                
                # 爆仓检测
                if pnl < 0 and value >= MIN_VALUE_USD:
                    liquidations.append(trade_row)
            
            # 打印表格
            df = pd.DataFrame(trade_data)
            print("\n=== 本月交易详情表格 ===")
            print(df.to_string(index=False))
            
            # 汇总
            print(f"\n=== 本月汇总 ===")
            print(f"总交易条数: {len(trades)}")
            print(f"累计实现盈亏: {round(total_pnl, 4)} USDC")
            if liquidations:
                print(f"潜在爆仓记录: {len(liquidations)} 条")
                print("\n爆仓详情:")
                liq_df = pd.DataFrame(liquidations)
                print(liq_df[['交易ID', '时间', '价值 (USDC)', '实现盈亏 (USDC)']].to_string(index=False))
            else:
                print("无爆仓记录（负盈亏 + >=100 USDC）。")
            
            # JSON导出（可选）
            with open('monthly_trades.json', 'w') as f:
                json.dump({'trades': trade_data, 'summary': {'total_pnl': round(total_pnl, 4), 'count': len(trades)}}, f, indent=2, ensure_ascii=False)
            print("\n详情已导出到 monthly_trades.json")
            
            return trades, total_pnl, liquidations
        
        else:
            print(f"API错误 {response.status_code}: {response.text}")
            return [], 0.0, []
    except Exception as e:
        print(f"异常: {e}")
        return [], 0.0, []

# 运行
if __name__ == "__main__":
    print("=== 2025年10月 CRV/USDC 合约交易详情查询 ===")
    trades, total_pnl, liq = fetch_monthly_trades()
    print(f"\n程序结束。总盈亏: {round(total_pnl, 4)} USDC")
```

#### 预期输出示例（假设有交易）
```
=== 2025年10月 CRV/USDC 合约交易详情查询 ===
云服务器IP: 3.5.1.2（白名单确认）
查询本月交易: https://fapi.binance.com/fapi/v1/userTrades?symbol=CRVUSDC...
成功查询到 2 条 CRV/USDC 交易记录（2025-10-01 ~ 2025-10-10 15:22:03）。

=== 本月交易详情表格 ===
 交易ID                  时间 方向   数量 (CRV)  价格 (USDC)  价值 (USDC) 实现盈亏 (USDC)  手续费 (USDC) 平仓类型
  12345  2025-10-07 12:32:46  卖出      116.1      0.7710        89.57        0.0246      0.0002   平多仓
  12346  2025-10-08 14:15:22  买入      120.0      0.7800        93.60       -0.0050      0.0002   平空仓

=== 本月汇总 ===
总交易条数: 2
累计实现盈亏: 0.0196 USDC
无爆仓记录（负盈亏 + >=100 USDC）。

详情已导出到 monthly_trades.json

程序结束。总盈亏: 0.0196 USDC
```

如果条数>1000，程序需分页（加循环调用API，limit=500）。跑完分享输出，我帮分析或优化（如加图表）！