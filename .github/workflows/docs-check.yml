name: 文档检查

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'docs/**'
      - 'README.md'
      - 'apps/*/README.md'
  pull_request:
    branches: [ main ]
    paths:
      - 'docs/**'
      - 'README.md'
      - 'apps/*/README.md'

jobs:
  docs-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: 设置Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'pnpm'

    - name: 安装依赖
      run: pnpm install

    - name: 检查文档链接
      run: pnpm docs:check-links

    - name: 检查Markdown格式
      run: pnpm docs:lint

    - name: 检查文档更新状态
      run: pnpm docs:status
      continue-on-error: true

    - name: 生成变更日志预览
      run: pnpm docs:changelog
      continue-on-error: true

    - name: 验证PR检查清单
      if: github.event_name == 'pull_request'
      run: |
        # 检查PR描述是否包含检查清单
        PR_BODY="${{ github.event.pull_request.body }}"
        if [[ "$PR_BODY" != *"docs updated?"* ]]; then
          echo "❌ PR描述缺少文档更新检查清单"
          exit 1
        fi
        echo "✅ PR检查清单格式正确"