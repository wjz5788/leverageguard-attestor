# 最小实单回路测试说明

## 概述

最小实单回路测试用于在主网上进行小额USDC支付测试，验证整个支付流程的完整性和正确性。

## 测试脚本

### test-real-order.js

主测试脚本，执行以下流程：

1. **网络连接** - 连接Base主网
2. **余额检查** - 检查USDC和ETH余额
3. **合约状态检查** - 验证CheckoutUSDC合约状态
4. **USDC授权** - 授权USDC给CheckoutUSDC合约
5. **订单生成** - 生成测试订单数据
6. **支付执行** - 调用buyPolicy函数进行支付
7. **状态验证** - 验证订单处理状态

### 使用方法

1. **配置环境变量**：
   ```bash
   cp .env.test .env
   # 编辑.env文件，设置你的测试钱包私钥
   ```

2. **运行测试**：
   ```bash
   node test-real-order.js
   ```

## 环境配置

### .env.test 配置文件

```bash
# 最小实单回路测试配置

# 测试钱包私钥（请替换为实际的测试钱包私钥）
TEST_WALLET_PRIVATE_KEY=你的测试钱包私钥

# 网络配置
BASE_RPC_URL=https://mainnet.base.org

# 合约地址
CHECKOUT_USDC_ADDRESS=0xc423c34b57730ba87fb74b99180663913a345d68
BASE_USDC_ADDRESS=0x833589fCD6EdB6E08f4c7C32D4f71B54Bda02913
TREASURY_ADDRESS=0xaa1f4df6fc3ad033cc71d561689189d11ab54f4b

# 测试参数
TEST_AMOUNT=1 # 1 USDC
```

## 测试要求

### 钱包准备

1. **测试钱包**：使用专门用于测试的钱包地址
2. **USDC余额**：至少1 USDC
3. **ETH余额**：至少0.001 ETH（用于gas费）

### 安全提醒

- 🔒 **不要使用主钱包**：建议使用专门用于测试的钱包
- 💰 **小额测试**：测试金额设置为1 USDC，避免大额损失
- 📝 **记录交易**：保存交易哈希用于后续验证

## 测试验证点

1. ✅ **网络连接** - 成功连接Base主网
2. ✅ **余额充足** - USDC和ETH余额满足要求
3. ✅ **合约状态** - CheckoutUSDC合约正常运行
4. ✅ **授权成功** - USDC授权给合约成功
5. ✅ **支付成功** - buyPolicy函数调用成功
6. ✅ **订单状态** - 订单被标记为已处理
7. ✅ **事件触发** - PremiumPaid事件被正确触发

## 预期结果

测试完成后，你应该看到：

- 交易哈希和区块号
- 订单处理状态
- 支付金额确认
- 后端监听器日志显示事件接收

## 故障排除

### 常见问题

1. **私钥错误**：检查.env文件中的私钥格式
2. **余额不足**：确保测试钱包有足够的USDC和ETH
3. **网络连接失败**：检查RPC URL和网络连接
4. **合约暂停**：检查CheckoutUSDC合约是否暂停

### 调试方法

1. 检查交易在BaseScan上的状态
2. 查看后端监听器日志
3. 验证数据库中的订单状态

## 后续步骤

测试成功后，可以进行：

1. **多金额测试**：测试不同支付金额
2. **并发测试**：测试多个并发支付
3. **边界测试**：测试最小/最大支付金额
4. **集成测试**：与前端界面集成测试