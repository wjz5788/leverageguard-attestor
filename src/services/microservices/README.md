# LeverageGuard 微服务架构

根据审核报告中的架构优化建议，本目录包含LeverageGuard项目的微服务架构实现代码。

## 系统架构概览

```
┌───────────────────────┐     ┌───────────────────────┐     ┌───────────────────────┐
│  订单验证服务         │     │  赔付处理服务         │     │  报告生成服务         │
│ (Order Verification)  │────>│  (Payout Processing)  │────>│ (Report Generation)   │
└───────────────────────┘     └───────────────────────┘     └───────────────────────┘
         │                           │                             │
         │                           │                             ▼
         │                           ▼                   ┌───────────────────────┐
         │                   ┌───────────────────────┐    │  数据可视化服务       │
         │                   │  资金管理服务         │    │ (Data Visualization)  │
         │                   │ (Fund Management)     │    └───────────────────────┘
         ▼                   └───────────────────────┘
┌───────────────────────┐             │
│  API网关服务          │             │
│ (API Gateway)         │<────────────┘
└───────────────────────┘
         │
         ▼
┌───────────────────────┐     ┌───────────────────────┐
│  外部系统接口         │     │  区块链节点           │
│ (External API)        │     │ (Blockchain Node)     │
└───────────────────────┘     └───────────────────────┘
```

## 微服务目录结构

```
microservices/
├── api_gateway/           # API网关服务
├── order_verification/    # 订单验证服务
├── payout_processing/     # 赔付处理服务
├── fund_management/       # 资金管理服务
├── report_generation/     # 报告生成服务
├── data_visualization/    # 数据可视化服务
├── common/                # 共享组件和工具类
├── configs/               # 配置文件
├── docker-compose.yml     # Docker Compose配置
└── README.md              # 项目说明
```

## 技术栈

- **编程语言**: Python 3.9+
- **Web框架**: FastAPI
- **消息队列**: RabbitMQ
- **数据库**: MongoDB (持久化存储) + Redis (缓存)
- **区块链交互**: Web3.py
- **监控**: Prometheus + Grafana
- **追踪**: OpenTelemetry
- **容器化**: Docker
- **API文档**: Swagger UI

## 快速开始

### 前提条件
- Docker和Docker Compose
- Python 3.9+
- 区块链节点访问
- 交易所API密钥

### 启动服务

```bash
# 在项目根目录执行
docker-compose up -d
```

### 访问服务

- API网关: http://localhost:8000/docs
- 监控界面: http://localhost:3000
- Redis管理界面: http://localhost:8001
- MongoDB管理界面: http://localhost:8081

## 服务说明

### 1. API网关服务
- 统一入口，路由请求
- 认证授权
- 负载均衡
- 请求限流

### 2. 订单验证服务
- 调用交易所API验证订单
- 检查爆仓事件
- 生成验证报告

### 3. 赔付处理服务
- 计算赔付金额
- 与智能合约交互
- 执行赔付操作

### 4. 资金管理服务
- 管理资金池
- 处理充值提现
- 监控资金安全

### 5. 报告生成服务
- 生成各类统计报告
- 支持多种格式输出
- 数据可视化图表

### 6. 数据可视化服务
- 提供Web界面展示数据
- 实时监控系统状态
- 支持数据导出

## 安全性要求

1. 所有API密钥和敏感信息必须存储在密钥管理系统中
2. 服务间通信必须使用加密协议
3. 定期进行安全审计和漏洞扫描
4. 实施严格的访问控制和权限管理

## 扩展建议

1. 根据业务需求，可以水平扩展各个微服务
2. 增加更多交易所支持
3. 实现多链支持
4. 增加AI预测功能，提高风险控制能力