# LiqPass US 前端：页面与按钮点击逻辑分析

本文档基于 `us-frontend` 源码（路由见 `us-frontend/src/App.tsx`）对各页面的主要按钮与点击交互进行汇总说明，涵盖触发逻辑、状态变化、数据交互、导航跳转与异常处理等。仅分析交互行为，不包含代码实现。

## 综述

- 路由入口：`us-frontend/src/App.tsx:32-62`
  - 主要路由：`/`（Landing）、`/products`、`/links`、`/links/create`、`/pay/:id`、`/success`、`/profile`、`/settings/api`、`/account/orders`、`/account/claims`、`/account/claims/new`、`/product/demo`、`/transparency`、`/help`、`/verify/order`。
- 全局上下文：
  - 钱包：`us-frontend/src/contexts/WalletContext.tsx` 提供 `connectWallet`、`switchToBase(testnet?: boolean)`、`address`、`onBase`、`busy`、`message` 等。
  - Toast：`us-frontend/src/contexts/ToastContext.tsx` 提供 `push({ title, desc?, type? })` 简易提示。
- 通用按钮组件：`us-frontend/src/components/ui/Button.tsx`，大多页面按钮为受控回调 `onClick`，支持 `disabled`、`variant`。

## 布局组件

### Header（头部导航）

- 文件：`us-frontend/src/components/layout/Header.tsx`
- 交互点：
  - 语言切换按钮
    - 文案：`EN`/`中文`
    - 逻辑：切换 `lang` 状态（`zh` ↔ `en`）。
  - 钱包按钮
    - 未连接：文案“连接钱包”，点击调用 `connectWallet()`；受 `busy` 控制禁用。
    - 已连接：文案“切到 Base”，点击调用 `switchToBase(false)` 切主网 Base；受 `busy` 控制禁用。
  - 账户下拉菜单（已连接）
    - 点击头像/地址打开/关闭菜单；点击菜单项（“订单管理”“赔付管理”“API 设置”）路由跳转并关闭菜单。
    - “退出”触发父级传入的 `onDisconnect()` 回调并关闭菜单。
    - 支持点击外部关闭、Esc 关闭、定位到触发按钮的右侧。
  - 账户下拉菜单（未连接）
    - 仅展示提示与“关闭”按钮，点击关闭菜单。

### Footer（页脚）

- 文件：`us-frontend/src/components/layout/Footer.tsx`
- 交互点：
  - 链接 `Docs` → `/docs`，`Legal` → `/legal`（路由占位，未在 App 注册）。

## 页面交互

### Landing（首页）

- 文件：`us-frontend/src/pages/Landing.tsx`
- 按钮：
  - “生成支付链接”：
    - 逻辑：调用 `buildLink("24h","BTCUSDT",20,24)` 生成演示链接，更新本地状态 `linkUrl`；设置钱包 `message` 与 Toast 提示 `linkCreated`。
    - 影响：右侧出现链接预览卡片。
  - 预览卡片中的“复制”：
    - 逻辑：调用 `navigator.clipboard.writeText(linkUrl)` 复制，成功提示 `copied`，失败将链接回写到钱包 `message`。
  - “去高级创建”：路由跳转至 `/links/create`。

### Products（产品页）

- 文件：`us-frontend/src/pages/Products.tsx`
- 表单控件：本金/杠杆/定价系数滑块与输入框，即时更新报价（非点击型交互）。
- 按钮：
  - “立即投保”：
    - 逻辑：按当前参数组装 `quote payload`，写入 `sessionStorage('lp_quote_preview')`，`navigate('/pay/preview', { state: { quote } })` 跳到支付页预览。
  - “创建支付链接”：
    - 逻辑：将当前参数拼接为查询串并 `window.location.href = '/links/create?...'` 导航到创建页（携带预填参数）。

### CreateLink（创建链接）

- 文件：`us-frontend/src/pages/CreateLink.tsx`
- 按钮：
  - “创建链接”（需先连接钱包）：
    - 验证：未连接钱包 → Toast 错误 `walletRequired`；表单必填项缺失 → Toast 错误 `fillAllFields`。
    - 请求：`POST /api/v1/links`，Body 包含 `product`、`symbol`、`amount`、`duration`。
    - 成功：复制返回 `link.url` 到剪贴板 → Toast `linkCreated` → 跳转 `/links`。
    - 失败：Toast 错误 `creationFailed`；复制失败 → Toast 错误 `copyFailed`。

### Links（链接列表）

- 文件：`us-frontend/src/pages/Links.tsx`
- 数据：使用本地 `mockLinks` 演示。
- 按钮：
  - “复制”：复制链接到剪贴板，成功 Toast `copied`，失败 Toast `copyFailed`。
  - “停用/激活”：仅本地状态提示（Toast），无实际后端更新。
  - 顶部“创建新链接”：路由至 `/links/create`。
  - 未连接钱包时：页面给出返回首页 `Link`。

### Payment（支付页）

- 文件：`us-frontend/src/pages/Payment.tsx`
- 数据来源两种：
  - 链接模式：`/pay/:id` 从 `mockPaymentData` 取定价信息。
  - 报价预览：从路由 `state.quote` 或 `sessionStorage('lp_quote_preview')` 读取用户报价。
- 按钮：
  - “连接钱包”：调用 `connectWallet()`。
  - “切换到Base”：调用 `switchToBase()`。
  - “确认支付 …USDC”：
    - 前置校验：未连接 → Toast `walletRequired`；未在 Base → Toast“请切换到Base网络”。
    - 处理：设置 `isProcessing=true`，2 秒后模拟成功；若为报价模式则清理 `lp_quote_preview`。
    - 成功：Toast“支付成功” → 跳转 `/success`。

### Success（支付成功）

- 文件：`us-frontend/src/pages/Success.tsx`
- 按钮：
  - “返回首页”：路由 `/`。
  - “管理支付链接”：路由 `/links`。
  - “下载收据”：样式按钮，无绑定逻辑（占位）。

### ProfilePage（个人中心）

- 文件：`us-frontend/src/pages/ProfilePage.tsx`
- 交互：
  - 未连接：展示“连接钱包”按钮 → 调用 `connectWallet()`。
  - 已连接：卡片入口为 `Link` 导航至 `/account/orders`、`/settings/api`、`/account/claims`。
  - “钱包设置”卡片按钮：点击触发占位 `alert('钱包设置功能开发中')`。

### OrdersPage（订单管理）

- 文件：`us-frontend/src/pages/OrdersPage.tsx`
- 按钮：
  - 顶部“刷新”：`GET /orders` 拉取订单；失败则回退到本地 `makeMockOrders()`，同时展示错误提示。
  - 卡片“发起理赔”：仅当状态为 `active` 且未过期时可点；当前实现为占位 `alert`，含参数 `orderId/orderRef`。
  - 卡片“详情”：占位 `alert` 展示订单 id。
  - 卡片交易哈希：按钮点击 `openChainTx(chain, txHash)` 新开 Basescan 链上交易页。

### ClaimsPage（赔付管理）

- 文件：`us-frontend/src/pages/ClaimsPage.tsx`
- 顶部切换：
  - “赔付列表”/“发起赔付”页签按钮：`navigate('/account/claims')` 与 `navigate('/account/claims/new')` 切换视图。
- 未连接：页面中央“连接钱包”按钮 → `connectWallet()`。
- 发起赔付流程（/new）：
  - “验证”按钮：根据订单号与合约信息调用 `apiClaimsVerify(...)`（本地模拟），期间有 `verifying` 态；成功后展示核验结果、证据与赔付金额。
  - “我已确认…”复选框：勾选后启用赔付按钮。
  - “赔付（你付gas）”按钮：调用本地模拟 `walletSendClaimPayout()`，期间 `paying` 态，成功生成 `txHash` 并以绿色提示展示。
- 说明：页面包含本地存储 `liqpass:claims` 的读写工具与占位 API，真实接入需替换为后端接口与链上调用。

### ProductDemo（产品演示）

- 文件：`us-frontend/src/pages/ProductDemo.tsx`
- 按钮：
  - “下单（演示）”：生成与 `Products` 相同结构的报价载荷，调用 `showModal(title, content)` 在页面内创建遮罩与弹窗并展示 JSON。
  - 弹窗交互：
    - 点击遮罩空白处或“关闭”按钮关闭弹窗（通过 `addEventListener('click', …)` 绑定 DOM 事件）。

### ApiSettings（API 设置）

- 文件：`us-frontend/src/pages/ApiSettings.tsx`
- 顶部按钮：
  - “刷新”：`loadAccounts()` 加载/重置账户列表（当前为本地 mock）。
  - “新建账号”：`openCreate()` 打开右侧抽屉，表单默认空白。
- 抽屉内：
  - 右上角 `✕`：`setDrawerOpen(false)` 关闭。
  - “保存”：`saveForm()`
    - 新建：构造新账号写入列表，设置 `status=unverified`、`masked.apiKeyLast4` 等，提示“已创建，待验证”。
    - 编辑：保存标签/环境，提示“已保存”。均会关闭抽屉。
  - “取消/关闭”：`setDrawerOpen(false)` 关闭（在次要按钮上）。
- 账户卡片（AccountCard）：
  - “验证”：`tryVerify()` 校验必填（不同交易所略有差异）→ 调用父 `onVerify(payload)`；父级 `doVerify()` 会：
    - 将账号 `status` 置为 `verifying`；打开结果抽屉；请求 `POST /api/verify`（演示：解析结果或错误）。
    - 成功：更新账号 `status=verified`、记录 `lastVerifyResult`，Toast“已生成回显，待确认”；结果抽屉可“下载 JSON”或“关闭”。
    - 失败：账号 `status=failed`，记录错误信息并 Toast。
  - “编辑”：`openEdit(id)` 打开抽屉并回填基础字段（密钥不回填）。
  - “删除”：浏览器 `confirm()` 二次确认后，将账号标记为 `deleted` 并移除本地表单缓存，Toast“已删除”。
  - “✅ 确认无误”：当存在回显且需要用户确认时，点击调用 `confirmEcho(id)` 将账号 `userConfirmedEcho=true` 并提示“已记录确认”。
- 结果抽屉：
  - “下载 JSON”：创建 Blob，构造临时 URL，触发下载。
  - “关闭”：`setResultOpen(false)`。

### TransparencyPage（透明度）

- 文件：`us-frontend/src/pages/TransparencyPage.tsx`
- 控制区：
  - range 切换（7天/30天/全部）：点击切换 `range` 并触发 `loadAll()` 拉取聚合数据（失败回退 mock）。
  - “刷新”：显式触发 `loadAll()`。
- 图表区：
  - 勾选“累计”：切换 `showCumulative`（折线 ↔ 面积累计）。
- 审计区：
  - “展开/收起审计信息”：切换 `auditOpen`。
  - 合约地址/审计哈希/默克尔根值右侧“复制”小按钮：`navigator.clipboard.writeText(...)` 复制。
- 分布图顶部切换：
  - “计数/保费”按钮：切换 `metric` 以更新甜甜圈的数值含义。

### Help（帮助中心）

- 文件：`us-frontend/src/pages/Help.tsx`
- 纯文本页，无实际按钮逻辑（仅文档内容）。

### OrderVerifier（订单验证器）

- 文件：`us-frontend/src/pages/OrderVerifier.tsx`
- 表单：订单参数与 API 密钥输入。
- 按钮：
  - “开始验证”（表单提交）：
    - 逻辑：阻止默认提交 → `POST /api/v1/verify/okx` → 加载态 → 成功将响应保存到本地并渲染结果；失败显示错误告警。
  - 结果区操作：
    - “查看完整证据”“下载证据包”：样式按钮（占位），未绑定真实行为。

## 其他说明

- 剪贴板：多处直接调用 `navigator.clipboard.writeText`，失败时通常以 Toast 或降级提示处理。
- 存储：
  - `localStorage`：产品页/演示页用于记忆输入；Claims 页用于本地存证演示。
  - `sessionStorage`：用于跨页传递报价预览（`lp_quote_preview`）。
- 网络请求：
  - 链接创建：`POST /api/v1/links`（CreateLink）。
  - 订单列表：`GET /orders`（OrdersPage，失败回退 mock）。
  - API 验证：`POST /api/verify`（ApiSettings 演示）与 `POST /api/v1/verify/okx`（OrderVerifier）。
- 导航：
  - 使用 `react-router-dom` 的 `Link` 与 `navigate`；个别地方（Products）直接设置 `window.location.href` 以携带查询参数。

---

如需我补充任一页面的时序图或将上述逻辑标注到具体组件结构图，请告知具体范围。

