<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <title>LeverSafe 爆仓保险计算器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
        font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont,
          "PingFang SC", "Microsoft YaHei", sans-serif;
      }
      body {
        margin: 0;
        padding: 24px;
        display: flex;
        justify-content: center;
        background: #f4f6fb;
      }
      .card {
        width: min(480px, 100%);
        background: #fff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 12px 32px rgba(26, 58, 112, 0.15);
      }
      h1 {
        margin-top: 0;
        font-size: 22px;
        color: #1a3a70;
      }
      .form-group {
        margin-bottom: 16px;
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
      }
      input[type="number"] {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #d5dcec;
        font-size: 16px;
        transition: border-color 0.2s ease;
      }
      input[type="number"]:focus {
        border-color: #2f6dfa;
        outline: none;
        box-shadow: 0 0 0 3px rgba(47, 109, 250, 0.15);
      }
      button {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        background: linear-gradient(135deg, #2f6dfa, #5f8bff);
        color: #fff;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 24px rgba(47, 109, 250, 0.25);
      }
      .result {
        margin-top: 24px;
        padding: 18px;
        border-radius: 12px;
        background: linear-gradient(135deg, #eef3ff, #ffffff);
        border: 1px solid #d5dcec;
      }
      .result p {
        margin: 6px 0;
        font-size: 15px;
        color: #243b6b;
      }
      .warning {
        color: #d14343;
        margin-top: 8px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>LeverSafe 爆仓保险计算器</h1>
      <div class="form-group">
        <label for="principal">本金 (50-500 USDT)</label>
        <input
          type="number"
          id="principal"
          min="50"
          max="500"
          step="0.01"
          value="100"
          autofocus
        />
      </div>
      <div class="form-group">
        <label for="leverage">杠杆倍数 (1-200)</label>
        <input
          type="number"
          id="leverage"
          min="1"
          max="200"
          step="1"
          value="20"
        />
      </div>
      <button id="calculate">计算保险</button>
      <div class="warning" id="message"></div>

      <div class="result" id="result" hidden>
        <p id="premium"></p>
        <p id="payout-ratio"></p>
        <p id="payout-amount"></p>
      </div>
    </div>

    <script>
      const MIN_PRINCIPAL = 50;
      const MAX_PRINCIPAL = 500;
      const MIN_LEVERAGE = 1;
      const MAX_LEVERAGE = 200;

      const fmt = (num) => Number(num).toFixed(2);

      function calculatePremium(principal, leverage) {
        const rate = Math.min(
          0.15,
          0.05 + (leverage - 20) * 0.001 + (principal / 500) * 0.02
        );
        return {
          ratePercent: Math.max(rate, 0) * 100,
          premium: Math.max(rate, 0) * principal,
        };
      }

      function calculatePayout(principal, leverage) {
        let ratio =
          0.25 + (leverage - 50) * 0.005 - (principal / 500) * 0.1;
        ratio = Math.max(0.1, Math.min(0.5, ratio));
        return { ratioPercent: ratio * 100, amount: ratio * principal };
      }

      function runCalculation() {
        const principalInput = document.getElementById("principal");
        const leverageInput = document.getElementById("leverage");
        const message = document.getElementById("message");
        const resultBox = document.getElementById("result");
        const principal = Number(principalInput.value);
        const leverage = Number(leverageInput.value);

        if (
          Number.isNaN(principal) ||
          Number.isNaN(leverage) ||
          principal < MIN_PRINCIPAL ||
          principal > MAX_PRINCIPAL ||
          leverage < MIN_LEVERAGE ||
          leverage > MAX_LEVERAGE
        ) {
          message.textContent =
            "请输入合法的本金与杠杆范围（本金 50-500 USDT，杠杆 1-200）。";
          resultBox.hidden = true;
          return;
        }

        const premium = calculatePremium(principal, leverage);
        const payout = calculatePayout(principal, leverage);

        document.getElementById(
          "premium"
        ).textContent = `保费：${fmt(
          premium.premium
        )} USDT（费率 ${fmt(premium.ratePercent)}%）`;
        document.getElementById(
          "payout-ratio"
        ).textContent = `赔付比例：${fmt(payout.ratioPercent)}%`;
        document.getElementById(
          "payout-amount"
        ).textContent = `赔付金额：${fmt(payout.amount)} USDT`;

        message.textContent = "";
        resultBox.hidden = false;
      }

      document
        .getElementById("calculate")
        .addEventListener("click", runCalculation);

      document
        .getElementById("principal")
        .addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            runCalculation();
          }
        });

      document
        .getElementById("leverage")
        .addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            runCalculation();
          }
        });

      runCalculation();
    </script>
  </body>
</html>
