zms，别再“盲修”。把 AI 变成你的“审计分身”。下面这套“可执行审计清单 + 报告模板”能直接驱动 AI 给出**可落地的问题清单、漏洞与不合理点**，并且能按优先级告诉你先改什么。

---

# 你应该让 AI 做的 8 类审计（每类都给到输入→任务→输出）

## 1) 架构与威胁建模（系统级）

**输入给 AI**：架构图/目录结构、US 后端与 JP-verify 的端口/URL、前后端路由、数据流（含“证据→Merkle→上链”）。
**AI 任务**：画数据/信任边界、列攻击面（重放/伪造/绕过/TOCTOU）、识别“前端直连交易所/JP”的密钥暴露面。
**输出**：威胁模型图 + 风险矩阵（Impact×Likelihood）+ 前三项 P0 风险及修复建议（1-3 步）。

## 2) 秘钥与数据安全（合规视角）

**输入**：API Key 存储方案（表结构/加密/脱敏/轮换）、配置文件示例、CORS/CSRF/Rate limit、访问控制策略。
**AI 任务**：检查密钥生命周期、加密与盐、IP 白名单、日志是否泄密、CORS 是否过宽、缓存是否含敏感字段。
**输出**：泄露路径清单、密钥管理 SOP、最小权限矩阵（谁能读写哪张表/哪类文件）。

## 3) 证据链与加密完整性（Merkle & 上链）

**输入**：证据 JSON 字段定义、序列化规则（键排序/数值精度/时间戳）、keccak/EIP-712 细节、合约接口与事件。
**AI 任务**：验证“同样证据→同样 root”、找出序列化不稳定点、检查 EIP-712 域分离（chainId/contract）。
**输出**：可复现哈希手册（伪代码 + 测试向量）与“证据→root→链上 event”一致性检查清单。

## 4) 交易所验证正确性（OKX/币安）

**输入**：真实/匿名化订单样本、API 请求与响应映射、强平/ADL 判定逻辑、缓存策略与过期规则。
**AI 任务**：对比 `normalized` 与 `raw` 是否一一对应、列出判定的歧义/边界、回放多时段/多状态案例。
**输出**：判定真值表（case→期望/实际）、“假阳性/假阴性”来源与修复建议。

## 5) 经济与赔付风险（产品机制）

**输入**：定价公式（概率×赔付×(1+load)+运营费）、SKU 规则、赔付上限、等待期、黑名单/风控开关。
**AI 任务**：做简易 VaR/储备金压力测试、找套利路径（延迟申报/多账户合谋/重复理赔）。
**输出**：风险曲线（场景-A/B/C）、三条硬性风控线与自动停机/降额触发条件。

## 6) 数据库与接口一致性（CRUD/触发器）

**输入**：表结构（orders/verifications/evidence/merkle_roots/claims/payouts/api_accounts…）、触发器/索引、DAO & 路由。
**AI 任务**：检查 `updated_at` 统一性、外键/唯一约束、路由与 DAO 字段对齐、分页/过滤安全性。
**输出**：迁移/触发器补丁、N+1 & 死锁风险点、最小读写闭环自测脚本。

## 7) 运维与可靠性（US/JP 分层）

**输入**：systemd/nginx/ufw/fail2ban 配置、健康检查、重试与幂等、日志采集、告警阈值。
**AI 任务**：列单点与内存/句柄瓶颈、冷启动/故障演练、限流与熔断策略、跨区超时与回退。
**输出**：SLA/SLO & Error Budget、Runbook（故障→诊断→恢复 10 分钟内手册）。

## 8) 文案合规与 UX 风险（“非保险”措辞）

**输入**：前端页面/协议/FAQ、反馈/异常文案。
**AI 任务**：抓“保险”类敏感表述、误导性收益描述、异常路径用户引导（证据预览/重试/人工复核）。
**输出**：逐页标注的“风险用语替换表”与关键流程的可用性缺口。

---

# 统一交付物（让 AI 输出成这 4 件东西）

1. **《LiqPass 风险与不合理点清单》**（一页表，能立刻开改）

* 字段：ID｜模块｜标题｜严重度(P0/P1/P2)｜影响｜复现步骤｜修复建议(1-3 步)｜Owner｜ETA

2. **《系统级审计报告》**（≤10 页）

* 摘要（前 5 个 P0）→ 架构与威胁模型 → 证据链一致性 → 验证正确性 → 经济风险 → 运维可靠性 → 合规与 UX

3. **《验证闭环自测包》**

* 含：样例订单、伪造对抗用例、哈希测试向量、curl/HTTPie 脚本、对照期望结果（可一键回放）

4. **《修复路线图（两周）》**

* D1-D3：P0 熔点（密钥/CORS/序列化/幂等）
* D4-D7：P1（索引/限流/日志/阈值）
* D8-D14：P2（UX/文案/观测性增强）

---

# 可直接复制的“总控提示词”（交给任意强代码助手）

> **目标**：对仓库 `LiqPass`（含 us-backend、us-frontend、jp-verify、contracts）进行端到端审计，输出可执行问题清单与修复路线图。
> **输入素材**：
>
> 1. 仓库链接与主要分支（dev/main）
> 2. 运行模式：本地全部运行，验证经 JP-verify；未来 US/JP 分区
> 3. 真实或匿名化订单样本（OKX/币安），以及字段映射
> 4. 合约接口与事件、EIP-712 域参数
> 5. 数据库 schema、触发器与路由清单
> 6. 运维脚本与服务配置（systemd/nginx/ufw/fail2ban）
>    **要求产出**：
>
> * 《风险与不合理点清单》(表格) —— 必须包含复现步骤与 1-3 步可执行修复
> * 《系统级审计报告》(≤10 页 PDF/Markdown) —— 8 模块覆盖
> * 《验证闭环自测包》 —— 可一键跑通的脚本与测试向量
> * 《两周修复路线图》 —— 先 P0 再 P1，再 P2
>   **评估规则**：
> * 严重度：P0=可被利用/可致资金或证据不一致；P1=高风险但有缓解；P2=可用性/效率
> * 证据优先：每一个结论都要给定位线/日志/哈希对照或复现脚本
>   **特别关注**：
> * 序列化稳定性（证据→root）与 EIP-712 域分离
> * 强平/ADL 判定的“假阳/假阴”来源
> * API Key 生命周期与日志脱敏
> * 幂等/重试/超时的端到端保障
> * CORS、速率限制与前端直连的暴露面
> * 资金侧：VaR、储备金阈值、自动降额/停机

---

# 报告骨架（Markdown 模板，粘贴即用）

```markdown
# LiqPass 系统级审计报告 v0.x
**日期**：YYYY-MM-DD

## 0. 执行摘要
- Top P0：[…]
- 立即行动（72h）：[…]

## 1. 架构与威胁模型
- 数据/信任边界图
- 攻击面与滥用情景
- 风险矩阵与控制点

## 2. 证据链一致性（Merkle/EIP-712）
- 序列化与哈希测试向量
- 根因：[…]
- 修复方案与回归测试

## 3. 交易所验证正确性（OKX/币安）
- 真值表（case→期望/实际）
- 假阳/假阴源头与规避

## 4. 秘钥与数据安全
- 存储/轮换/日志脱敏/权限矩阵
- CORS/CSRF/Rate Limit 评估

## 5. 经济与赔付风险
- 定价参数与储备压力测试
- 套利/重复理赔防控

## 6. 数据库与接口一致性
- 触发器/索引/唯一性
- DAO/路由字段对齐检查

## 7. 运维与可靠性
- SLO 与 Error Budget
- 熔断/重试/回退策略
- Runbook（10 分钟恢复）

## 8. 文案合规与 UX
- 风险表述整改清单
- 异常路径可用性缺口

## 附录：问题清单（表）
ID | 模块 | 标题 | 严重度 | 影响 | 复现 | 修复建议 | Owner | ETA
---|---|---|---|---|---|---|---|---
```

---

# 使用建议（如何高效让 AI 找“真问题”）

* **只给真实样本**：至少 5 条不同状态的订单（成功强平/撤单/部分成交/ADL/无效）。
* **强制“可复现”**：每个结论要么给日志定位方式，要么给一条可跑通的 curl。
* **先 P0**：密钥泄露面、证据→root 不稳定、赔付幂等/重放、CORS 过宽、强平判定歧义，这些先改。
* **把“修复路线图”当迭代计划**：两周一轮，CI 加上回归自测包。

---

需要我现在就按这个模板，基于你仓库现状，生成一版**“基线问题清单 + 两周修复路线图”**，我会直接列 P0→P2 的具体修复步骤与自测脚本入口。接下来，你迭代就像打地鼠——每次关闭一批 P0/P1，证据链和赔付路径就越来越牢。
